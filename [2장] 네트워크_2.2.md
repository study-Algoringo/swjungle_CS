# 2.2 TCP/IP 4계층 모델
인터넷 프로토콜 스위트 ➡ 프로토콜의 집합

![](2023-04-19-11-18-25.png)
## 2.2.1 계층 구조
- 특정 계층이 변경되었을 때 다른 계층이 영향을 받지 않도록 설계됨
### 애플리케이션 계층
- 웹 서비스, 이메일 등 서비스를 실질적으로 사람들에게 제공하는 계층
### 전송 계층
- 송신자와 수신자를 연결하는 통신 서비스 제공
- TCP, UDP
  - TCP, UDP의 차이: 순서 보장의 여부. TCP의 경우 신뢰성을 구축하여 수신
  
***가상회선 패킷 교환 방식**
- 각 패킷에 가상회선 식별자가 포함됨
- 모든 패킷을 전송하면 가상회선이 해제되고 패킷들은 전송된 순서대로 도착

***데이터그램 패킷 교환 방식**
- 패킷이 독립적으로 이동하며 최적의 경로를 선택하여 가는 방식
- 독립적으로 이동하기 때문에, 분할된 여러 패킷은 서로 다른 경로로 전송될 수 있고, 도착 순서가 다를 수 있음

**TCP 연결 성립 과정**
: 3-way handshake
![](2023-04-23-02-37-15.png)
1. SYN 단계
   
   : 서버에 클라이언트의 ISN을 담아 SYN을 보냄
2. SYN + ACK 단계
   
   : 서버의 ISN을 보내며 승인번호로 클라이언트의 ISN + 1을 보냄
3. ACK 단계

   : ISN + 1한 값인 승인번호를 받아 ACK를 서버에 보냄

**TCP 연결 해제 과정**
: 4-way handshake
![](2023-04-23-02-55-23.png)
1. 클라이언트가 연결을 닫으려고 할 때 FIN으로 설정된 세그먼트를 보냄
   
2. 서버는 클라이언트로 ACK라는 승인 세그먼트를 보냄
   
3. 서버는 ACK를 보내고 일정 시간 이후에 클라이언트에 FIN이라는 세그먼트를 보냄
   
4. 클라이언트는 TIME_WAIT 상태가 되고 다시 서버로 ACK를 보내서 서버는 CLOSED 상태가 됨. 이후 클라이언트는 어느 정도의 시간을 대기하고 연결이 닫히고 모든 자원의 연결이 해제됨

> **TIME_WAIT**: 
소켓이 바로 소멸되지 않고 일정 시간 유지되는 상태.

>**데이터 무결성**: 
데이터의 정확성과 일관성을 유지하고 보증하는 것

### 인터넷 계층
- 장치로부터 받은 네트워크 패킷을 IP주소로 지정된 목적지로 전송하기 위해 사용되는 계층
- 상대방이 제대로 받았는지에 대해 보장하지 않는 비연결형적인 특징을 가짐

### 링크 계층
- 실질적으로 데이터를 전달하며 장치 간에 신호를 주고받는 '규칙'을 정하는 계층
- 물리 계층과 데이터 링크 계층으로 나뉨
> 유선 LAN
   - 전이중화 통신: 양쪽 장치가 동시에 송수신할 수 있음. 현재 유선 LAN의 통신 방식
   - ↔ 반이중화 통신(CSMA/CD): 데이터를 보낸 이후 충돌이 발생할 시에 재전송
   - 유선 랜을 이루는 케이블로는 트위스트 페어 케이블과 광섬유 케이블이 대표적
     - 트위스트 케이블: 구리 선을 꼬아 만든 케이블
     - 광섬유 케이블: 광섬유로 만든 케이블. 장거리 고속 통신 가능
> 무선 랜
  - 반이중화 통신 사용
    - 양쪽 장치는 서로 통신할 수 있지만 동시에는 통신할 수 없음. 즉, 한 번에 한 방향만 통신 가능
    - 그렇기 때문에, 충돌 방지 시스템이 필요함
    - ```Ex``` ) CSMA/CA
      - 데이터를 송신하기 전에 무선 매체를 살핌
      - 캐리어 감지: 회선이 비어있는지 판단
      - IFS: 랜덤 값을 기반으로 정해진 시간만큼 기다림
      - 이후에 데이터 송신
  - 무선 랜을 이루는 주파수: 2.4GHz, 5GHz
    - WIFI
      - 전자기기들이 무선 LAN 신호에 연결할 수 있도록 하는 기술. 무선 접속 장치(AP)가 필요
    - BSS
      - 기본 서비스 집합을 의미. 동일 BSS에 있는 AP들과 장치들이 서로 통신이 가능한 구조
    - ESS
      - 하나 이상의 연결된 BSS 그룹. 장거리 무선 통신을 제공하므로, 장소 간의 이동에 중단 없이 연결할 수 있음

    ![](2023-04-23-17-11-48.png)

>이더넷 프레임
  
  데이터 링크 계층에서 이더넷 프레임을 통해 전달받은 데이터의 에러를 검출하고 캡슐화함
  ![](2023-04-23-17-23-14.png)

### 계층 간 데이터 송수신
캡슐화 ➡ 비캡슐화 과정으로 이루어짐
![](![](2023-04-23-17-29-53.png).png)
> 캡슐화 과정
  - `데이터그램화` : 애플리케이션 계층 ➡ 전송 계층
  - `패킷화` : 전송 계층 ➡ 인터넷 계층
  - `프레임화` : 인터넷 계층 ➡ 링크 계층
> 비캡슐화 과정
  - 캡슐화 과정의 역순 (패킷화➡데이터그램화➡메세지화)

## 2.2.2 PDU
- 제어 관련 정보들이 포함된 헤더, 데이터를 의미하는 페이로드로 구성되어 있음
- 계층마다 부르는 명칭이 다름
  -  애플리케이션 계층: 메시지
  -  전송 계층: 세그먼트(TCP), 데이터그램(UDP)
  -  인터넷 계층: 패킷
  -  링크 계층: 프레임(데이터 링크 계층), 비트(물리 계층)

**❓ 모든 통신을 비트로 하지 않는 이유**
- 물론 모든 통신을 비트로 한다면 속도는 빠를 것이다.
- but, 일부 계층에서는 비트로 통신하지 않는다. - 예) 애플리케이션 계층
- 헤더에 authorization 값 등 다른 값들을 넣는 확장을 위해서 문자열을 기반으로 하는 것이 효율적이기 때문